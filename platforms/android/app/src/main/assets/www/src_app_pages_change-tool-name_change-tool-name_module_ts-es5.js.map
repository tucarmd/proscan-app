{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,UAAMA,MAAM,GAAW,CACrB;AACEC,YAAI,EAAE,EADR;AAEEC,iBAAS,EAAEC;AAFb,OADqB,CAAvB;;UAWaC;;;;;yBAAAA;AAA+B;;;cAA/BA;;;kBAHF,CAACC,mEAAsBL,MAAtB,CAAD,GACCK;;;;4HAECD,kCAA+B;AAAAE;AAAAC,oBAFhCF,yDAEgC;AAAA;AAFpB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCKXG;;;;;yBAAAA;AAAwB;;;cAAxBA;;;kBARF,CACPC,yDADO,EAEPC,uDAFO,EAGPC,uDAHO,EAIPC,6FAJO;;;;4HAQEJ,2BAAwB;AAAAK,yBAFpBC,sEAEoB;AAFFR,oBAL/BG,yDAK+B,EAJ/BC,uDAI+B,EAH/BC,uDAG+B,EAF/BC,6FAE+B;AAEE;AAJF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACG7BG;;AAAkFA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAA+BA;;AAAsBA;;;;;;AAAtBA;;AAAAA;;;;;;;;AAFnHA;;AACEA;;AAAiBA;;AAAqBA;;AAAKA;;AAAmBA;;AAC9DA;;AACAA;;AACEA;;AACEA;;AAA6BA;AAAAA;;AAAA;;AAAA;AAAA;;AAC3BA;;AAAmCA;;AAAMA;;AAC3CA;;AACFA;;AACFA;;AACFA;;;;;;AARwEA;;AAAAA;;;;UCO/DC;AAgBX,qCACUC,MADV,EAEUC,eAFV,EAGUC,iBAHV,EAIUC,WAJV,EAKUC,QALV,EAMUC,IANV,EAOUC,cAPV,EAQUC,GARV,EAQkB;AAAA;;AAAA;;AAEhB,yDAAM,oBAAN;AATQ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAvBV,wBAAQ,kBAAR;AAGA,6BAAa,IAAb;AACA,wBAAQ,CAAR;AAEA,wBAAQ,KAAR;AACA,yBAAS,eAAT;AACA,+BAAe,KAAf;AACA,2BAAW,EAAX;AACA,2BAAW,EAAX;;AAEAC,yDAAmB,IAAnB;;AACAC,4DAAsB,KAAtB;;AACAC,wEAAkC,KAAlC;;AASkB;AAGjB;;;;;;iBAED,kBAAS,CAACC,MAAD,EAAoB;AAAA;;AAAA,gBAAXC,MAAW,uEAAF,EAAE;AAC3B,iBAAKP,IAAL,CAAUQ,GAAV,CAAc,YAAK;AACjB,kBAAIF,MAAM,IAAI,IAAd,EAAoB;AAClB,sBAAI,CAACG,UAAL,GAAkBH,MAAlB;;AACA,sBAAI,CAACI,MAAL,CAAYC,KAAZ,CAAkB,MAAI,CAACF,UAAL,GAAkB,KAAlB,GAA0BF,MAA5C;AACD;;AACD,oBAAI,CAACK,UAAL,GAAkBL,MAAlB;AACD,aAND;AAOD;;;iBAEK,qBAAY,CAACM,MAAD,EAAgB;;;;;;yBAC7BC;;;;;AACDC,2BAAO,CAACC,GAAR,CAAY,wBAAZ;;AACA,2BAAM,KAAKd,GAAL,CAASe,QAAT,EAAN;;;;AAEY,2BAAM,KAAKrB,eAAL,CAAqBsB,MAArB,CAA4B;AAC9CtC,+BAAS,EAAEuC,sHADmC;AAE9CC,oCAAc,EAAE;AACdC,8BAAM,EAAER,MAAM,CAACS,EADD;AAEdC,gCAAQ,EAAEV,MAAM,CAACW;AAFH,uBAF8B;AAM9CC,8BAAQ,EAAE,yCANoC;AAO9CC,kCAAY,EAAE,IAPgC;AAQ9CC,qCAAe,EAAE;AAR6B,qBAA5B,CAAN;;;AAARC;;AAUN,2BAAMA,KAAK,CAACC,OAAN,EAAN;;;;AACa,2BAAMD,KAAK,CAACE,YAAN,EAAN;;;AAAPC;;0BACHA,IAAI,IAAIA,IAAI,CAACA,IAAb,IAAqBA,IAAI,CAACA,IAAL,CAAUC;;;;;AAChCC,gCAAY,CAACC,OAAb,CAAqBrB,MAAM,CAACS,EAA5B,EAAgCS,IAAI,CAACA,IAAL,CAAUC,OAA1C;qDACO,KAAKnC,iBAAL,CAAuBsC,SAAvB,CAAiCC,sEAAjC;;;;;;;;AAEV;;;iBAEK,yBAAgB;;;;;;;;AACpB,yBAAKC,UAAL,GAAkB,KAAlB;AACA,yBAAKC,YAAL,GAAoB,KAApB;AACA,yBAAKD,UAAL,GAAkB,IAAlB;AACA,yBAAKE,KAAL,GAAa,kBAAb;AACA,yBAAKjC,MAAL,GAAc,eAAd;AACIkC,0BAAM;AACVA,uBAAG,CAACC,OAAJ,GAAc,EAAd;AACA,0FAAItC,mCAAJ,EAAwBuC,UAAU,CAAC;AAAA,6BAAY;AAAA;;AAAA;AAAA;AAAA;AAC7C,kCAAI,CAAC,KAAKD,OAAN,IAAiB,KAAKA,OAAL,CAAaE,MAAb,KAAwB,CAA7C,EAAgD;AAC9C,qCAAK9C,iBAAL,CACG+C,IADH,CACQR,kFADR,EACoC;AAChCS,6CAAW,EAAE;AACXC,8CAAU,EAAEV;AADD;AADmB,iCADpC,EAMGW,IANH,CAMQ;AAAA,yCAAY;AAAA;AAAA;AAAA;AAChB,8CAAIjC,kFAAJ,EAA0B;AACxBC,mDAAO,CAACC,GAAR,CAAY,wBAAZ;AACA,iDAAKd,GAAL,CAASe,QAAT;AACD;;AAJe;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAZ;AAAA,iCANR;AAYD;;AAd4C;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAZ;AAAA,qBAAD,EAe/B+B,wFAf+B,CAAlC,EAeoC,GAfpC;;;;;;;;AAgBD;;;iBAEK,wBAAe;;;;;AACnB,yBAAKX,UAAL,GAAkB,IAAlB;;AACA,2BAAM,sEAAIY,6BAAJ,EAAI,GAAJ,EAAIC,oCAAJ,EAAsBC,IAAtB,MAAN;;;;;;;;AACD;;;iBAoEK,yBAAgB;;;;;;;AACpB,yBAAKb,YAAL,GAAoB,IAApB;AACA,yBAAK7B,UAAL,GAAkB,EAAlB;AACA,yBAAKG,UAAL,GAAkB,sBAAlB;sDACO,KAAKjB,MAAL,CAAYwC,SAAZ,CAAsBC,sEAAtB,EAAsCW,IAAtC,CAA2C;AAAA,6BAAY;AAAA;AAAA;AAAA;AAC5D,kCAAIjC,kFAAJ,EAA0B;AACxB,qCAAKZ,GAAL,CAASe,QAAT;AACD;;AAH2D;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAZ;AAAA,qBAA3C;;;;;;;;AAKR;;;iBAED,wBAAe;AAAA;;AACb,gBAAI,sEAAId,mCAAJ,EAAI,GAAJ,CAAJ,EAA2B;AACzBiD,0BAAY,CAAC,sEAAIjD,mCAAJ,EAAI,GAAJ,CAAD,CAAZ;AACA,oFAAIA,mCAAJ,EAAwB,IAAxB,EAA4B,GAA5B;AACD,aAJY,CAMb;;;AACAkD,oBAAQ,CAACC,mBAAT,CAA6B,YAA7B,EAA2C,YAAK;AAC9C,oBAAI,CAAC5C,MAAL,CAAYC,KAAZ,CAAkB,8BAAlB;AACD,aAFD;AAGD;;;iBAEM,0CAAiC;AAAA;;AACtC,iBAAKZ,QAAL,CAAcwD,KAAd,GAAsBR,IAAtB,CAA2B,YAAK;AAC9BM,sBAAQ,CAACG,gBAAT,CAA0B,YAA1B,EAAwC,YAAK;AAC3C,sBAAI,CAACC,sBAAL;AACD,eAFD;AAGD,aAJD;AAKD;;;iBAEO,+BAAsB;AAC5B,iBAAKC,MAAL;AACD;;;iBAEK,eAAM,GAAe;AAAA,gBAAdC,OAAc,uEAAJ,IAAI;;;;;;;AACzB,wBAAI7C,iFAAJ,EAAyB;AACvB,2BAAKwB,YAAL,GAAoB,IAApB;;AACA,0BAAIqB,OAAJ,EAAa;AACX,6BAAKhE,MAAL,CAAYgE,OAAZ,CACE,eADF,EAEEX,0EAFF,EAGE;AAAA,iCAAY;AAAA;AAAA;AAAA;AACV,uCAAKY,gBAAL;;AADU;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAZ;AAAA,yBAHF,EAME,YAAK;AACH,gCAAI,CAACtB,YAAL,GAAoB,KAApB;AACD,yBARH;AAUD,uBAXD,MAWO;AACL,6BAAKsB,gBAAL;AACD;AACF;;;;;;;;AACF;;QApNqCC;;;;;;;;;;qBA8FhC/C;;;;;AACF,qBAAKZ,GAAL,CAASe,QAAT,GAAoB8B,IAApB,CAAyB,YAAK;AAC5B,wBAAI,CAAC7C,GAAL,CAAS4D,SAAT,CAAmB,EAAnB,EAAuBC,SAAvB,CAAiC,UAACC,QAAD,EAAa;AAC5C,wBAAIA,QAAQ,CAAC,MAAD,CAAR,IAAoBA,QAAQ,CAAC,MAAD,CAAR,CAAiBrB,MAAjB,GAA0B,CAAlD,EAAqD;AACnD,0BACEsB,uDAAWjB,wFAAX,EAA6CgB,QAAQ,CAAC,MAAD,CAArD,CADF,EAEE;AACA,8BAAI,CAACtD,MAAL,CAAYC,KAAZ,CAAkB,cAAlB,EAAkCqD,QAAlC;;AACA,4BAAME,KAAK,GAAG,MAAI,CAACzB,OAAL,CAAa0B,SAAb,CACZ,UAACC,CAAD;AAAA,iCAAOA,CAAC,CAAC9C,EAAF,KAAS0C,QAAQ,CAAC,IAAD,CAAxB;AAAA,yBADY,CAAd;;AAGA,4BAAIE,KAAK,GAAG,CAAZ,EAAe;AACb,kGAAIjB,6BAAJ,EAAI,GAAJ,EAAIoB,6BAAJ,EAAelB,IAAf,SAAgBa,QAAQ,CAAC,IAAD,CAAxB,EAAgCA,QAAQ,CAAC,MAAD,CAAxC;AACA,gCAAI,CAAC3B,UAAL,GAAkB,KAAlB;AACAiC,iHAAqB,MAAI,CAACrE,cAA1B;AACD;;AACD,gGAAIG,sCAAJ,EAA2B,MAAI,CAACqC,OAAL,CAAaE,MAAb,GAAsB,CAAjD,EAAkD,GAAlD;;AACA,4BAAI,wEAAIvC,sCAAJ,EAAI,GAAJ,CAAJ,EAA8B;AAC5B,kGAAI6C,6BAAJ,EAAI,GAAJ,EAAIsB,kDAAJ,EAAoCpB,IAApC,SAAuCJ,IAAvC;AACD;AACF;AACF;AACF,mBApBD;AAqBD,iBAtBD;;;;;;AAwBc,uBAAM,KAAKjD,WAAL,CAAiB0E,yBAAjB,EAAN;;;AAAV/B;;sBACAA,OAAO,IAAIA,OAAO,CAACE,MAAR,GAAiB;;;;;AAC9B,uBAAOF,OAAO,CAACE,MAAf,EAAuB;AACjB9B,wBADiB,GACR4B,OAAO,CAACgC,KAAR,EADQ;AAErB,uBAAK/D,MAAL,CAAYC,KAAZ,CAAkB,oBAAlB,EAAwCE,MAAxC;AACA,wFAAIoC,6BAAJ,EAAI,GAAJ,EAAIoB,6BAAJ,EAAelB,IAAf,OAAgBtC,MAAM,CAAC,IAAD,CAAtB,EAA8BA,MAAM,CAAC,MAAD,CAApC;AACA,uBAAKwB,UAAL,GAAkB,KAAlB;AACAiC,yGAAqB,KAAKrE,cAA1B;AACD;;AACD,sFAAIG,sCAAJ,EAA2B,KAAKqC,OAAL,CAAaE,MAAb,GAAsB,CAAjD,EAAkD,GAAlD;;qBACI,sEAAIvC,sCAAJ,EAAI,GAAJ;;;;;;AACF,uBAAM,sEAAI6C,6BAAJ,EAAI,GAAJ,EAAIsB,kDAAJ,EAAoCpB,IAApC,MAAN;;;;;;;;gFAMG7B,IAAYoD,MAAY;AACjC,YAAMC,SAAS,GAAG1C,YAAY,CAAC2C,OAAb,CAAqBtD,EAArB,CAAlB;;AACA,YAAGqD,SAAH,EAAa;AACX,eAAKlC,OAAL,CAAaoC,IAAb,CAAkB,IAAIC,6DAAJ,CAAYxD,EAAZ,EAAgBqD,SAAhB,EAA2B,IAA3B,CAAlB;AACD,SAFD,MAEO;AACL,eAAKlC,OAAL,CAAaoC,IAAb,CAAkB,IAAIC,6DAAJ,CAAYxD,EAAZ,EAAgBoD,IAAhB,CAAlB;AACD;AACF;;;;;;oBAGM,sEAAIrE,kDAAJ,EAAI,GAAJ;;;;;AACH,sFAAIA,kDAAJ,EAAuC,IAAvC,EAA2C,GAA3C;;AACc,uBAAM,KAAKT,eAAL,CAAqBsB,MAArB,CAA4B;AAC9CtC,2BAAS,EAAEmG,kIADmC;AAE9CrD,8BAAY,EAAE,IAFgC;AAG9CC,iCAAe,EAAE,KAH6B;AAI9CF,0BAAQ,EAAE;AAJoC,iBAA5B,CAAN;;;AAARG;;AAMN,uBAAMA,KAAK,CAACC,OAAN,EAAN;;;;AACA,uBAAMD,KAAK,CAACE,YAAN,EAAN;;;;;;;;;;;yBA3JOpC,qBAAkBD;AAAA;;;cAAlBC;AAAkBsF;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA;ADzB/B5F;;AACEA;;AACEA;;AACEA;;AAAIA;;AAAmBA;;AACvBA;;AACEA;;AACFA;;AACAA;;AAA6BA;;AAAaA;;AAC1CA;;AACEA;;AACEA;;AAA6BA;AAAA,qBAAS+C,YAAT;AAAiB,aAAjB;;AAC3B/C;;AAAuCA;;AAAMA;;AAC/CA;;AACFA;;AACFA;;AACFA;;AACAA;;AAWFA;;AACFA;;;;AA1B6BA;;AAAAA;;AAcuCA;;AAAAA;;;;;;;;","names":["routes","path","component","_change_tool_name_page__WEBPACK_IMPORTED_MODULE_0__","ChangeToolNamePageRoutingModule","_angular_router__WEBPACK_IMPORTED_MODULE_2__","imports","exports","ChangeToolNamePageModule","_angular_common__WEBPACK_IMPORTED_MODULE_3__","_angular_forms__WEBPACK_IMPORTED_MODULE_4__","_ionic_angular__WEBPACK_IMPORTED_MODULE_5__","_change_tool_name_routing_module__WEBPACK_IMPORTED_MODULE_0__","declarations","_change_tool_name_page__WEBPACK_IMPORTED_MODULE_1__","_angular_core__WEBPACK_IMPORTED_MODULE_13__","ChangeToolNamePage","helper","modalController","navigationService","connService","platform","zone","changeDetector","ble","_ChangeToolNamePage_scanningTimeout","_ChangeToolNamePage_hasMultipleDevices","_ChangeToolNamePage_multipleToolsFoundPopupVisible","result","status","run","resultText","logger","debug","statusText","device","src_app_services_state_app_state__WEBPACK_IMPORTED_MODULE_5__","console","log","stopScan","create","src_app_modals_change_tool_name_modal_change_tool_name_modal_page__WEBPACK_IMPORTED_MODULE_8__","componentProps","toolId","id","toolName","displayName","cssClass","showBackdrop","backdropDismiss","modal","present","onDidDismiss","data","newName","localStorage","setItem","popToRoot","src_app_app_routing_module__WEBPACK_IMPORTED_MODULE_2__","isScanning","isCancelling","title","ctx","devices","setTimeout","length","goTo","queryParams","sourcePage","then","src_app_configs_app_config__WEBPACK_IMPORTED_MODULE_0__","_ChangeToolNamePage_instances","_ChangeToolNamePage_startScanDevices","call","clearTimeout","document","removeEventListener","ready","addEventListener","customHandleBackButton","cancel","confirm","doCancelScanning","src_app_bases_base_controller__WEBPACK_IMPORTED_MODULE_4__","startScan","subscribe","btDevice","lodash__WEBPACK_IMPORTED_MODULE_3___default","index","findIndex","d","_ChangeToolNamePage_addDevice","src_app_services_utility_carmd_utils__WEBPACK_IMPORTED_MODULE_6__","_ChangeToolNamePage_displayMultipleToolsFoundPopup","discoverBluetoothDevices2","shift","name","localName","getItem","push","src_app_models_app_model__WEBPACK_IMPORTED_MODULE_1__","src_app_modals_multiple_tools_found_modal_multiple_tools_found_modal_page__WEBPACK_IMPORTED_MODULE_7__","selectors","features","decls","vars","consts","template"],"sources":["webpack:///src/app/pages/change-tool-name/change-tool-name-routing.module.ts","webpack:///src/app/pages/change-tool-name/change-tool-name.module.ts","webpack:///src/app/pages/change-tool-name/change-tool-name.page.html","webpack:///src/app/pages/change-tool-name/change-tool-name.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ChangeToolNamePage } from './change-tool-name.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ChangeToolNamePage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ChangeToolNamePageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ChangeToolNamePageRoutingModule } from './change-tool-name-routing.module';\n\nimport { ChangeToolNamePage } from './change-tool-name.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ChangeToolNamePageRoutingModule\n  ],\n  declarations: [ChangeToolNamePage]\n})\nexport class ChangeToolNamePageModule {}\n","<ion-content class=\"ion-padding\">\n  <div class=\"app-content-center-midle\">\n    <div class=\"text-center\" [hidden]=\"!isScanning\">\n      <h2>Scanning devices...</h2>\n      <div class=\"app-spinner-wrap\">\n        <ion-spinner name=\"circles\" class=\"size-8\"></ion-spinner>\n      </div>\n      <p class=\"font-size-20 mb-5\">Starting scan</p>\n      <ion-grid>\n        <ion-row>\n          <ion-col class=\"text-center\" (click)=\"cancel()\">\n            <a class=\"text-secondary font-size-18\">Cancel</a>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </div>\n    <div class=\"text-center w-100 app-select-device-box px-3 py-4\" *ngIf=\"devices && devices.length > 0\">\n      <h2 class=\"mb-5\">Please select device <br/>to change Tool Name</h2>\n      <ion-button class=\"app-button mb-5\" expand=\"block\" *ngFor=\"let device of devices\" (click)=\"selectDevice(device)\">{{device.displayName}}</ion-button>\n      <ion-grid>\n        <ion-row>\n          <ion-col class=\"text-center\" (click)=\"cancel()\">\n            <a class=\"text-white font-size-18\">Cancel</a>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </div>\n  </div>\n</ion-content>\n","import { ChangeDetectorRef, Component, NgZone } from '@angular/core';\nimport { ModalController, Platform } from '@ionic/angular';\nimport {\n  AppConfig,\n  AppStrings,\n  SUPPORTED_BLUETOOTH_DEVICE_NAMES,\n} from 'src/app/configs/app.config';\nimport { BleData } from 'src/app/models/app.model';\nimport { NavigationService } from 'src/app/services/navigation.service';\nimport { RoutePath } from 'src/app/app-routing.module';\nimport _ from 'lodash';\nimport { BLE } from '@ionic-native/ble/ngx';\nimport { HelperService } from 'src/app/services/helper.service';\nimport { BaseController } from 'src/app/bases/base-controller';\nimport { AppState } from 'src/app/services/state/app.state';\nimport { ConnectivityService } from 'src/app/services/innova-vci-service/src/connectivity/connectivity.service';\nimport { CarMDUtils } from 'src/app/services/utility/carmd.utils';\nimport { MultipleToolsFoundModalPage } from 'src/app/modals/multiple-tools-found-modal/multiple-tools-found-modal.page';\nimport { ChangeToolNameModalPage } from 'src/app/modals/change-tool-name-modal/change-tool-name-modal.page';\n\n@Component({\n  selector: 'app-change-tool-name',\n  templateUrl: './change-tool-name.page.html',\n  styleUrls: ['./change-tool-name.page.scss'],\n})\nexport class ChangeToolNamePage extends BaseController {\n  title = 'Scanning devices';\n  statusText: string;\n  resultText: string;\n  isScanning = true;\n  retry = 0;\n  timer: any;\n  found = false;\n  result = 'Starting scan';\n  isCancelling = false;\n  deviceId = '';\n  toolName = '';\n  devices: BleData[];\n  #scanningTimeout = null;\n  #hasMultipleDevices = false;\n  #multipleToolsFoundPopupVisible = false;\n  constructor(\n    private helper: HelperService,\n    private modalController: ModalController,\n    private navigationService: NavigationService,\n    private connService: ConnectivityService,\n    private platform: Platform,\n    private zone: NgZone,\n    private changeDetector: ChangeDetectorRef,\n    private ble: BLE\n  ) {\n    super('ChangeToolNamePage');\n  }\n\n  setStatus(result, status = '') {\n    this.zone.run(() => {\n      if (result != null) {\n        this.resultText = result;\n        this.logger.debug(this.resultText + ' - ' + status);\n      }\n      this.statusText = status;\n    });\n  }\n\n  async selectDevice(device: BleData) {\n    if(AppState.isOnAndroid){\n      console.log('Call this.ble.stopScan');\n      await this.ble.stopScan();\n    }\n    const modal = await this.modalController.create({\n      component: ChangeToolNameModalPage,\n      componentProps: {\n        toolId: device.id,\n        toolName: device.displayName\n      },\n      cssClass: 'app-modal-dialog-2 px-2 keyboard-active',\n      showBackdrop: true,\n      backdropDismiss: false\n    });\n    await modal.present();\n    const data = await modal.onDidDismiss();\n    if(data && data.data && data.data.newName){\n      localStorage.setItem(device.id, data.data.newName);\n      return this.navigationService.popToRoot(RoutePath.Home);\n    }\n  }\n\n  async ionViewWillEnter() {\n    this.isScanning = false;\n    this.isCancelling = false;\n    this.isScanning = true;\n    this.title = 'Scanning devices';\n    this.result = 'Starting scan';\n    let ctx = this;\n    ctx.devices = [];\n    this.#scanningTimeout = setTimeout(async () => {\n      if (!this.devices || this.devices.length === 0) {\n        this.navigationService\n          .goTo(RoutePath.ConnectionFailed, {\n            queryParams: {\n              sourcePage: RoutePath.ChangeToolName,\n            },\n          })\n          .then(async () => {\n            if (AppState.isOnAndroid) {\n              console.log('Call this.ble.stopScan');\n              this.ble.stopScan();\n            }\n          });\n      }\n    }, AppConfig.scanningDevicesTimeout);\n  }\n\n  async ionViewDidEnter() {\n    this.isScanning = true;\n    await this.#startScanDevices();\n  }\n\n  async #startScanDevices() {\n    if (AppState.isOnAndroid) {\n      this.ble.stopScan().then(() => {\n        this.ble.startScan([]).subscribe((btDevice) => {\n          if (btDevice['name'] && btDevice['name'].length > 0) {\n            if (\n              _.includes(SUPPORTED_BLUETOOTH_DEVICE_NAMES, btDevice['name'])\n            ) {\n              this.logger.debug('Device found', btDevice);\n              const index = this.devices.findIndex(\n                (d) => d.id === btDevice['id']\n              );\n              if (index < 0) {\n                this.#addDevice(btDevice['id'], btDevice['name']);\n                this.isScanning = false;\n                CarMDUtils.refreshUI(this.changeDetector);\n              }\n              this.#hasMultipleDevices = this.devices.length > 1;\n              if (this.#hasMultipleDevices) {\n                this.#displayMultipleToolsFoundPopup().then();\n              }\n            }\n          }\n        });\n      });\n    } else {\n      let devices = await this.connService.discoverBluetoothDevices2();\n      if (devices && devices.length > 0) {\n        while (devices.length) {\n          let device = devices.shift();\n          this.logger.debug('Found Pro15 device', device);\n          this.#addDevice(device['id'], device['name']);\n          this.isScanning = false;\n          CarMDUtils.refreshUI(this.changeDetector);\n        }\n        this.#hasMultipleDevices = this.devices.length > 1;\n        if (this.#hasMultipleDevices) {\n          await this.#displayMultipleToolsFoundPopup();\n        }\n      }\n    }\n  }\n\n  #addDevice(id: string, name: string){\n    const localName = localStorage.getItem(id);\n    if(localName){\n      this.devices.push(new BleData(id, localName, true));\n    } else {\n      this.devices.push(new BleData(id, name));\n    }\n  }\n\n  async #displayMultipleToolsFoundPopup() {\n    if (!this.#multipleToolsFoundPopupVisible) {\n      this.#multipleToolsFoundPopupVisible = true;\n      const modal = await this.modalController.create({\n        component: MultipleToolsFoundModalPage,\n        showBackdrop: true,\n        backdropDismiss: false,\n        cssClass: 'app-modal-dialog-3 px-2',\n      });\n      await modal.present();\n      await modal.onDidDismiss();\n    }\n  }\n\n  async doCancelScanning() {\n    this.isCancelling = true;\n    this.resultText = '';\n    this.statusText = 'One moment please...';\n    return this.helper.popToRoot(RoutePath.Home).then(async () => {\n      if (AppState.isOnAndroid) {\n        this.ble.stopScan();\n      }\n    });\n  }\n\n  ionViewDidLeave() {\n    if (this.#scanningTimeout) {\n      clearTimeout(this.#scanningTimeout);\n      this.#scanningTimeout = null;\n    }\n\n    // Unregister the custom back button action for this page\n    document.removeEventListener('backbutton', () => {\n      this.logger.debug('unregister back button event');\n    });\n  }\n\n  public initializeBackButtonCustomHandler(): void {\n    this.platform.ready().then(() => {\n      document.addEventListener('backbutton', () => {\n        this.customHandleBackButton();\n      });\n    });\n  }\n\n  private customHandleBackButton(): void {\n    this.cancel();\n  }\n\n  async cancel(confirm = true) {\n    if (AppState.isOnDevice) {\n      this.isCancelling = true;\n      if (confirm) {\n        this.helper.confirm(\n          'Are you sure?',\n          AppStrings.CONFIRM,\n          async () => {\n            this.doCancelScanning();\n          },\n          () => {\n            this.isCancelling = false;\n          }\n        );\n      } else {\n        this.doCancelScanning();\n      }\n    }\n  }\n}\n"]}