{"version":3,"mappings":"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","names":["_angular_core__WEBPACK_IMPORTED_MODULE_5__","VIN_MAX_LENGTH","DASH_CHARACTER","EnterVinPage","modal","toolService","helper","navParams","reportService","vehicleService","vinForm","_angular_forms__WEBPACK_IMPORTED_MODULE_6__","vin","invalidVIN","isVehiclesNotFound","logger","debug","isModal","reportSession","getReportSession","setTimeout","vinInput","setFocus","hasVIN","value","isLoading","re","RegExp","matches","match","length","decodeVin","result","success","dismiss","data","getDlcLocationByVin","_EnterVinPage_instances","_EnterVinPage_formatVin","call","vinLength","src_app_bases_base_controller__WEBPACK_IMPORTED_MODULE_0__","replace","slice","toUpperCase","selectors","viewQuery","ctx"],"sources":["webpack:///src/app/pages/enter-vin/enter-vin.page.html","webpack:///src/app/pages/enter-vin/enter-vin.page.ts"],"sourcesContent":["<ion-header class=\"ion-no-border\">\n  <ion-toolbar mode=\"md\" *ngIf=\"isAndroid\">\n    <ion-title>Enter VIN</ion-title>\n    <ion-buttons slot=\"end\" [hidden]=\"isModal\">\n      <ion-button (click)=\"close()\">\n        <ion-icon name=\"close-outline\" class=\"font-size-28\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n  </ion-toolbar>\n  <ion-toolbar mode=\"ios\" *ngIf=\"!isAndroid\">\n    <ion-title>Enter VIN</ion-title>\n    <ion-buttons slot=\"end\" [hidden]=\"isModal\">\n      <ion-button (click)=\"close()\">\n        <ion-icon name=\"close-outline\" class=\"font-size-28\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n  </ion-toolbar>\n</ion-header>\n<ion-content class=\"ion-padding\">\n  <div class=\"app-content-center-midle\">\n    <div class=\"w-100 app-open-keybroad-01\" [formGroup]=\"vinForm\">\n      <h4>VIN ({{vinLength}})</h4>\n      <p class=\"mb-3\">\n        <ion-input (keyup.enter)=\"submit()\" inputmode=\"text\" maxlength=\"17\" class=\"app-input vin-input\" (ionChange)=\"vinChanges()\" #vinInput placeholder=\"*****************\"></ion-input>\n      </p>\n      <div class=\"mb-4 text-danger\" [hidden]=\"!invalidVIN\">\n        <span>VIN is required and must be 17 chars in length.</span>\n      </div>\n      <div class=\"mb-4 text-danger\" [hidden]=\"!isVehiclesNotFound\">\n        <span>Invalid VIN. Either this VIN is too new for our system, or our system cannot decode this VIN, or this VIN is invalid. Please enter a different VIN.</span>\n      </div>\n      <ion-button (click)=\"submit()\" class=\"app-button mt-2\" [disabled]=\"!hasVIN\" expand=\"block\">\n        <span [hidden]=\"isLoading\">Submit</span>\n        <ion-spinner [hidden]=\"!isLoading\"></ion-spinner>\n      </ion-button>\n    </div>\n  </div>\n</ion-content>\n","import { Component, ViewChild } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { IonInput, ModalController, NavParams } from '@ionic/angular';\nimport { BaseController } from 'src/app/bases/base-controller';\nimport { ReportSession } from 'src/app/models/report-session';\nimport { HelperService } from 'src/app/services/helper.service';\nimport { ReportServiceProvider } from 'src/app/services/report-service/report-service';\nimport { AppState } from 'src/app/services/state/app.state';\nimport { ToolServiceProvider } from 'src/app/services/tool-service/tool-service';\nimport { VehicleServiceProvider } from 'src/app/services/vehicle-service/vehicle-service';\n\nexport const VIN_MAX_LENGTH = 17;\nconst DASH_CHARACTER = '-';\n@Component({\n  selector: 'app-enter-vin',\n  templateUrl: './enter-vin.page.html',\n  styleUrls: ['./enter-vin.page.scss'],\n})\nexport class EnterVinPage extends BaseController {\n  reportSession: ReportSession;\n  public isModal = false;\n  @ViewChild('vinInput') vinInput: IonInput;\n  public vinForm: FormGroup;\n  isLoading;\n  invalidVIN = false;\n  hasVIN = false;\n  isVehiclesNotFound = false;\n  vinLength = VIN_MAX_LENGTH;\n  constructor(public modal: ModalController,\n    public toolService: ToolServiceProvider,\n    public helper: HelperService,\n    public navParams: NavParams,\n    public reportService: ReportServiceProvider,\n    public vehicleService: VehicleServiceProvider) {\n      super('EnterVinPage');\n  }\n  \n  ngOnInit() {\n    this.vinForm = new FormGroup({\n      vin: new FormControl('', [Validators.required, Validators.maxLength(17)])\n    });\n  }\n\n  ionViewWillEnter(){\n    this.invalidVIN = false;\n    this.isVehiclesNotFound = false;\n    this.logger.debug(this.isModal);\n    this.reportSession = this.reportService.getReportSession();\n  }\n\n  ionViewDidEnter(){\n    setTimeout(() => {\n      this.vinInput.setFocus();\n    }, 1000);\n  }\n\n  async submit() {\n    this.hasVIN = false;\n    let vin = this.vinInput.value as string;\n    this.isLoading = true;\n    let re = new RegExp('[a-zA-Z0-9]{17}$');\n    let matches = vin.match(re);\n    if (matches && matches.length) {\n      vin = matches[0];\n      if (this.isModal) {\n        let result = await this.vehicleService.decodeVin(vin);\n        this.isLoading = false;\n        if (result.success) {\n          await this.modal.dismiss({ vin: vin, data: result.data});\n        }\n        else {\n          this.hasVIN = true;\n          this.isVehiclesNotFound = true;\n        }\n      } else {\n        let result = await this.vehicleService.getDlcLocationByVin(vin);\n        this.isLoading = false;\n        if (result.success) {\n          await this.modal.dismiss({ vin: vin, data: result.data});\n        }\n        else {\n          this.hasVIN = true;\n          this.isVehiclesNotFound = true;\n        }\n      }\n    } else {\n      this.hasVIN = true;\n      this.isLoading = false;\n      this.isVehiclesNotFound = true;\n    }\n  }\n\n  #formatVin(vin: string) {\n    if (vin) {\n      vin = vin.replace(/[^a-zA-Z0-9]/gi, '');\n      vin = vin.replace(/[qo]/gi, '0');\n      vin = vin.replace(/[i]/gi, '1');\n      vin = vin.slice(0, 17);\n      vin = vin.toUpperCase();\n    }\n    return vin;\n  }\n\n  async vinChanges(){\n    this.isVehiclesNotFound = false;\n    const vin: string = this.#formatVin(this.vinInput.value as string);\n    this.vinLength = VIN_MAX_LENGTH - vin.length;\n    this.vinInput.value = vin;\n    if(vin.length === VIN_MAX_LENGTH){\n      this.hasVIN = true;\n    } else {\n      this.hasVIN = false;\n    }\n  }\n\n  public close() {\n    this.modal.dismiss(null);\n  }\n}\n"]}